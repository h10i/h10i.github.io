<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Ubuntu とデュアルブートしている Windows を削除してパーティションを整理する | h10i</title><meta name=keywords content><meta name=description content="概要

Ubuntu と Windows をデュアルブートしているが、Windows が不要となったため削除する。
削除した Windows のパーティションは、Ubuntu のパーティションに統合する。

環境

Ubuntu Server 24.04 LTS
Windows 11
Ubuntu Server 24.04 LTS (Live 環境)

調査
現在のパーティションを確認する。"><meta name=author content="Me"><link rel=canonical href=https://h10i.github.io/posts/2025/09/08/removing-windows-from-a-dual-boot-setup-with-ubuntu-and-organize-the-partitions/><link crossorigin=anonymous href=/assets/css/stylesheet.2780b2949415d83a5092f8d6a5c074eff2baae241a65c5f1a089d3bc320b858a.css integrity="sha256-J4CylJQV2DpQkvjWpcB07/K6riQaZcXxoInTvDILhYo=" rel="preload stylesheet" as=style><link rel=icon href=https://h10i.github.io/img/favicon.svg><link rel=icon type=image/png sizes=16x16 href=https://h10i.github.io/img/favicon.svg><link rel=icon type=image/png sizes=32x32 href=https://h10i.github.io/img/favicon.svg><link rel=apple-touch-icon href=https://h10i.github.io/img/favicon.svg><link rel=mask-icon href=https://h10i.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://h10i.github.io/posts/2025/09/08/removing-windows-from-a-dual-boot-setup-with-ubuntu-and-organize-the-partitions/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://h10i.github.io/posts/2025/09/08/removing-windows-from-a-dual-boot-setup-with-ubuntu-and-organize-the-partitions/"><meta property="og:site_name" content="h10i"><meta property="og:title" content="Ubuntu とデュアルブートしている Windows を削除してパーティションを整理する"><meta property="og:description" content="概要 Ubuntu と Windows をデュアルブートしているが、Windows が不要となったため削除する。 削除した Windows のパーティションは、Ubuntu のパーティションに統合する。 環境 Ubuntu Server 24.04 LTS Windows 11 Ubuntu Server 24.04 LTS (Live 環境) 調査 現在のパーティションを確認する。"><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-09-08T17:08:04+09:00"><meta property="article:modified_time" content="2025-09-08T17:08:04+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Ubuntu とデュアルブートしている Windows を削除してパーティションを整理する"><meta name=twitter:description content="概要

Ubuntu と Windows をデュアルブートしているが、Windows が不要となったため削除する。
削除した Windows のパーティションは、Ubuntu のパーティションに統合する。

環境

Ubuntu Server 24.04 LTS
Windows 11
Ubuntu Server 24.04 LTS (Live 環境)

調査
現在のパーティションを確認する。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://h10i.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Ubuntu とデュアルブートしている Windows を削除してパーティションを整理する","item":"https://h10i.github.io/posts/2025/09/08/removing-windows-from-a-dual-boot-setup-with-ubuntu-and-organize-the-partitions/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Ubuntu とデュアルブートしている Windows を削除してパーティションを整理する","name":"Ubuntu とデュアルブートしている Windows を削除してパーティションを整理する","description":"概要 Ubuntu と Windows をデュアルブートしているが、Windows が不要となったため削除する。 削除した Windows のパーティションは、Ubuntu のパーティションに統合する。 環境 Ubuntu Server 24.04 LTS Windows 11 Ubuntu Server 24.04 LTS (Live 環境) 調査 現在のパーティションを確認する。\n","keywords":[""],"articleBody":"概要 Ubuntu と Windows をデュアルブートしているが、Windows が不要となったため削除する。 削除した Windows のパーティションは、Ubuntu のパーティションに統合する。 環境 Ubuntu Server 24.04 LTS Windows 11 Ubuntu Server 24.04 LTS (Live 環境) 調査 現在のパーティションを確認する。\nsudo parted -l Model: 512GB SSD (nvme) Disk /dev/nvme0n1: 512GB Sector size (logical/physical): 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 1049kB 106MB 105MB fat32 EFI system partition boot, esp 2 106MB 123MB 16.8MB Microsoft reserved partition msftres 3 123MB 107GB 107GB ntfs Basic data partition msftdata 4 256GB 511GB 256GB ext4 Basic data partition msftdata 5 511GB 512GB 849MB ntfs hidden, diag 次の用途で使用されている。\n/dev/nvme0n1p1: EFI System Partition (ESP, 共用) /dev/nvme0n1p2: Windows 用の Microsoft Reserved Partition (不要) /dev/nvme0n1p3: Windows C ドライブ (NTFS, 不要) /dev/nvme0n1p4: Ubuntu のルート (ext4, 必要) /dev/nvme0n1p5: Windows 回復パーティション (NTFS, 不要) p2, p3, p5 が Windows 関連の領域であり、削除対象となる。\n削除した領域は Ubuntu で使っている p4 を拡張したい。パーティションの移動が必要となるため、Live で起動する Ubuntu 環境を別途用意し、Live 環境でパーティションの再配置を実施する必要がある。\n具体的には、p2, p3, p5 を削除した後、新たに p2 を作成する。その後、p4 のデータを p2 に移動する。最後に、p4 を削除し、p2 を拡張する。\n手順 Live 環境の Ubuntu パーティションの変更はオンライン環境では実施できないため、USB メモリ等の Live 環境で Ubuntu を起動し、作業する。Windows で USB メモリに Live 環境の Ubuntu を作成する場合は Rufus 等を使用する。\nUSB メモリを対象端末に接続し、USB メモリの Ubuntu を起動する。\nTry or install Ubuntu を選択する。\nインストーラが起動したら、上部分にある Help を選択する。\nSSH で作業する場合、インストーラの上部分にある Help \u003e Help on SSH access を選択すると、installer ユーザで SSH 接続するための情報が表示される。(SSH 接続した状態でも今回の手順は実施可能であるため、作業しやすいやり方で可)\nHelp \u003e Enter Shell より、シェルを起動する。以降はこのシェル上で作業する。\nWindows 関連パーティションの削除 最悪データが消えても復旧できるように、バックアップしてから作業すること。\nLive 環境の Ubuntu のシェル (root ユーザ) にて実施する。\np4 が Ubuntu の領域 (ext4) であることを確認する。\nlsblk -f Windows 関連のパーティションを削除するため、parted コマンドを実行する。\nparted /dev/nvme0n1 現在のパーティションを表示する。\n(parted) print Model: 512GB SSD (nvme) Disk /dev/nvme0n1: 512GB Sector size (logical/physical): 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 1049kB 106MB 105MB fat32 EFI system partition boot, esp 2 106MB 123MB 16.8MB Microsoft reserved partition msftres 3 123MB 107GB 107GB ntfs Basic data partition msftdata 4 256GB 511GB 256GB ext4 Basic data partition msftdata 5 511GB 512GB 849MB ntfs hidden, diag p2, p3, p5 が Windows 関連のパーティションであることを確認し、削除する。\n(parted) rm 2 # Windows 用の Microsoft Reserved Partition (parted) rm 3 # Windows C ドライブ (parted) rm 5 # Windows 回復パーティション 削除できたことを確認する。\n(parted) print Model: 512GB SSD (nvme) Disk /dev/nvme0n1: 512GB Sector size (logical/physical): 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 1049kB 106MB 105MB fat32 EFI system partition boot, esp 4 256GB 511GB 256GB ext4 Basic data partition msftdata parted を終了する。\n(parted) quit nvme0n1p4 をチェックする。\ne2fsck -f /dev/nvme0n1p4 必要に応じて最適化する。\ne2fsck 1.47.0 (5-Feb-2023) Pass 1: Checking inodes, blocks, and sizes Inode 14418651 extent tree (at level 1) could be shorter. Optimize? yes Pass 1E: Optimizing extent trees Pass 2: Checking directory structure Pass 3: Checking directory connectivity Pass 4: Checking reference counts Pass 5: Checking group summary information /dev/nvme0n1p4: ***** FILE SYSTEM WAS MODIFIED ***** /dev/nvme0n1p4: 1231810/15605760 files (0.2% non-contiguous), 24418593/62394368 blocks パーティションの作成とデータ移行 Live 環境の Ubuntu のシェル (root ユーザ) にて実施する。\nパーティションの後方に空き領域を作るため、ファイルシステムを一時的に縮小する。\nresize2fs /dev/nvme0n1p4 200G resize2fs 1.47.0 (5-Feb-2023) Resizing the filesystem on /dev/nvme0n1p4 to 52428800 (4k) blocks. The filesystem on /dev/nvme0n1p4 is now 52428800 (4k) blocks long. p4 (ext4) の領域を左に移動するため、parted を実行する。\nparted /dev/nvme0n1 現在の状態を再度確認する。\n(parted) print Model: 512GB SSD (nvme) Disk /dev/nvme0n1: 512GB Sector size (logical/physical): 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 1049kB 106MB 105MB fat32 EFI system partition boot, esp 4 256GB 511GB 256GB ext4 Basic data partition msftdata p1 と p4 の間 (106MB ~ 256GB) に新しいパーティションを作成する。\n(parted) mkpart primary ext4 106MB 256GB p2 が作成されたことを確認する。\n(parted) print Model: 512GB SSD (nvme) Disk /dev/nvme0n1: 512GB Sector size (logical/physical): 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 1049kB 106MB 105MB fat32 EFI system partition boot, esp 2 106MB 256GB 256GB ext4 primary 4 256GB 511GB 256GB ext4 Basic data partition msftdata parted を終了する。\n(parted) quit 作成した p2 をフォーマットする。\nmkfs.ext4 /dev/nvme0n1p2 mke2fs 1.47.0 (5-Feb-2023) Discarding device blocks: done Creating filesystem with 62398720 4k blocks and 15605760 inodes Filesystem UUID: 2543fd22-fc5d-430f-87be-9ef247334f4e Superblock backups stored on blocks: 32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 4096000, 7962624, 11239424, 20480000, 23887872 Allocating group tables: done Writing inode tables: done Creating journal (262144 blocks): done Writing superblocks and filesystem accounting information: done p4 と p2 をそれぞれマウントする。(今回は移行元を /mnt/old とし、移行先を /mnt/new とする。)\nmkdir /mnt/old \u0026\u0026 mount /dev/nvme0n1p4 /mnt/old mkdir /mnt/new \u0026\u0026 mount /dev/nvme0n1p2 /mnt/new データの使用量を確認する。\ndf -h p4 の使用量が p2 より小さいことを確認する。もし p2 より大きい場合は、別の領域に p4 のデータをバックアップする。\n... /dev/nvme0n1p2 234G 28K 222G 1% /mnt/new /dev/nvme0n1p4 196G 89G 98G 48% /mnt/old p4 にあるデータを p2 にコピーする。\nrsync -aHAX /mnt/old/ /mnt/new/ アンマウントする。\numount /mnt/new umount /mnt/old p2 をチェックする。\ne2fsck -f /dev/nvme0n1p2 e2fsck 1.47.0 (5-Feb-2023) Pass 1: Checking inodes, blocks, and sizes Pass 2: Checking directory structure Pass 3: Checking directory connectivity Pass 4: Checking reference counts Pass 5: Checking group summary information /dev/nvme0n1p2: 1231810/15605760 files (0.1% non-contiguous), 24516082/62398720 blocks 動作確認 Live 環境の Ubuntu のシェル (root ユーザ) にて実施する。\np4 を削除する前に、p2 のデータで正しく起動できるか確認する。\np2 の UUID を確認する。\nblkid /dev/nvme0n1p2 UUID の値をコピーしておく。\n/dev/nvme0n1p2: UUID=\"2543fd22-fc5d-430f-87be-9ef247334f4e\" BLOCK_SIZE=\"4096\" TYPE=\"ext4\" PARTLABEL=\"primary\" PARTUUID=\"78887ccc-a4be-45ea-a88d-f8e0bdc90f64\" 同様にして、p4 の UUID も確認する。\nblkid /dev/nvme0n1p4 /dev/nvme0n1p4: UUID=\"e5bc1fee-fc92-4b0f-8b8c-7bc78cf72f86\" BLOCK_SIZE=\"4096\" TYPE=\"ext4\" PARTLABEL=\"Basic data partition\" PARTUUID=\"075a8eda-ecb5-428b-994a-f59333013d01\" ブートローダを更新するため、必要な仮想ファイルシステムをバインドする。\nmount /dev/nvme0n1p2 /mnt/new mount /dev/nvme0n1p1 /mnt/new/boot/efi for i in /dev /dev/pts /proc /sys /run; do mount --bind $i /mnt/new$i done chroot 環境に入る。\nchroot /mnt/new grub.cfg の中身を確認する。\nless /boot/efi/EFI/ubuntu/grub.cfg p4 の UUID が root に設定されている。\nsearch.fs_uuid e5bc1fee-fc92-4b0f-8b8c-7bc78cf72f86 root set prefix=($root)'/boot/grub' configfile $prefix/grub.cfg 任意のエディタで /etc/fstab を開く。\nvi /etc/fstab 既存の p4 のエントリの UUID を書き換え、上書き保存する。\n... - /dev/disk/by-uuid/e5bc1fee-fc92-4b0f-8b8c-7bc78cf72f86 / ext4 defaults 0 1 + /dev/disk/by-uuid/2543fd22-fc5d-430f-87be-9ef247334f4e / ext4 defaults 0 1 ... GRUB を再生成する。\ngrub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=ubuntu Installing for x86_64-efi platform. grub-install: warning: EFI variables cannot be set on this system. grub-install: warning: You will have to complete the GRUB setup manually. Installation finished. No error reported. update-grub Sourcing file `/etc/default/grub' Generating grub configuration file ... Found linux image: /boot/vmlinuz-6.8.0-79-generic Found initrd image: /boot/initrd.img-6.8.0-79-generic Found linux image: /boot/vmlinuz-6.8.0-78-generic Found initrd image: /boot/initrd.img-6.8.0-78-generic Warning: os-prober will be executed to detect other bootable partitions. Its output will be used to detect bootable binaries on them and create new boot entries. Found Windows Boot Manager on /dev/nvme0n1p1@/EFI/Microsoft/Boot/bootmgfw.efi Found Ubuntu 24.04.3 LTS (24.04) on /dev/nvme0n1p4 Adding boot menu entry for UEFI Firmware Settings ... done grub.cfg の中身を確認する。\nless /boot/efi/EFI/ubuntu/grub.cfg p2 の UUID が root に設定されている。\nsearch.fs_uuid 2543fd22-fc5d-430f-87be-9ef247334f4e root set prefix=($root)'/boot/grub' configfile $prefix/grub.cfg この時点で、 p2 をもとに起動するはずなので、サーバを再起動する。(ブートローダの選択肢で p4 の Ubuntu を選ばないように注意する。)\np2 で Ubuntu が起動したら、SSH 接続や各種サービスの利用等、問題なく使えることを確認する。\nパーティションの削除と拡張 p2 で問題なく起動できることが確認出来たら、 p4 を削除し、 p2 を拡張する。\n以降の手順は Live 環境の Ubuntu で実行する。\nparted コマンドを実行する。\nparted /dev/nvme0n1 現在のパーティションを表示する。\n(parted) print Model: 512GB SSD (nvme) Disk /dev/nvme0n1: 512GB Sector size (logical/physical): 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 1049kB 106MB 105MB fat32 EFI system partition boot, esp 2 106MB 256GB 256GB ext4 primary 4 256GB 511GB 256GB ext4 Basic data partition msftdata p4 を削除し、p2 のサイズを 100% にする。\n(parted) rm 4 (parted) resizepart 2 100% 現在のパーティションを表示し、p2 が最大サイズまで拡張されていることを確認する。\n(parted) print Model: 512GB SSD (nvme) Disk /dev/nvme0n1: 512GB Sector size (logical/physical): 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 1049kB 106MB 105MB fat32 EFI system partition boot, esp 2 106MB 512GB 512GB ext4 primary parted を終了する。\n(parted) quit p2 をチェックする。\ne2fsck -f /dev/nvme0n1p2 e2fsck 1.47.0 (5-Feb-2023) Pass 1: Checking inodes, blocks, and sizes Pass 2: Checking directory structure Pass 3: Checking directory connectivity Pass 4: Checking reference counts Pass 5: Checking group summary information /dev/nvme0n1p2: 1231812/15605760 files (0.1% non-contiguous), 24481005/62398720 blocks p2 のファイルシステムを最大まで拡張する。\nresize2fs /dev/nvme0n1p2 resize2fs 1.47.0 (5-Feb-2023) Resizing the filesystem on /dev/nvme0n1p2 to 125001041 (4k) blocks. The filesystem on /dev/nvme0n1p2 is now 125001041 (4k) blocks long. 再起動し、問題なく起動することを確認する。\nブート設定の削除 EFI にある Windows のブート設定を削除する。この作業は Live の Ubuntu ではなく、p2 にある Ubuntu を起動し、ログインした状態で実施する。\nsudo mount /dev/nvme0n1p1 /mnt sudo rm -rf /mnt/EFI/Microsoft sudo umount /mnt GRUB を再生成する。\nsudo update-grub これでブートローダの選択肢から不要な OS が消え、パーティション p2 の Ubuntu が起動する。\n参考 parted(8) — Arch manual pages e2fsck(8) — Arch manual pages resize2fs(8) — Arch manual pages grub-install(8) — Arch manual pages efibootmgr(8) — Arch manual pages ","wordCount":"2765","inLanguage":"en","datePublished":"2025-09-08T17:08:04+09:00","dateModified":"2025-09-08T17:08:04+09:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://h10i.github.io/posts/2025/09/08/removing-windows-from-a-dual-boot-setup-with-ubuntu-and-organize-the-partitions/"},"publisher":{"@type":"Organization","name":"h10i","logo":{"@type":"ImageObject","url":"https://h10i.github.io/img/favicon.svg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://h10i.github.io/ accesskey=h title="h10i (Alt + H)">h10i</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://h10i.github.io/archives/ title=archives><span>archives</span></a></li><li><a href=https://h10i.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://h10i.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://h10i.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://h10i.github.io/>ホーム</a>&nbsp;»&nbsp;<a href=https://h10i.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Ubuntu とデュアルブートしている Windows を削除してパーティションを整理する</h1><div class=post-meta><span title='2025-09-08 17:08:04 +0900 +0900'>2025-09-08</span>&nbsp;·&nbsp;6 分&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/h10i/h10i-blog/blob/main/content/posts/2025/09/08/index.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目次</span></summary><div class=inner><ul><li><a href=#%e6%a6%82%e8%a6%81 aria-label=概要>概要</a></li><li><a href=#%e7%92%b0%e5%a2%83 aria-label=環境>環境</a></li><li><a href=#%e8%aa%bf%e6%9f%bb aria-label=調査>調査</a></li><li><a href=#%e6%89%8b%e9%a0%86 aria-label=手順>手順</a><ul><li><a href=#live-%e7%92%b0%e5%a2%83%e3%81%ae-ubuntu aria-label="Live 環境の Ubuntu">Live 環境の Ubuntu</a></li><li><a href=#windows-%e9%96%a2%e9%80%a3%e3%83%91%e3%83%bc%e3%83%86%e3%82%a3%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ae%e5%89%8a%e9%99%a4 aria-label="Windows 関連パーティションの削除">Windows 関連パーティションの削除</a></li><li><a href=#%e3%83%91%e3%83%bc%e3%83%86%e3%82%a3%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ae%e4%bd%9c%e6%88%90%e3%81%a8%e3%83%87%e3%83%bc%e3%82%bf%e7%a7%bb%e8%a1%8c aria-label=パーティションの作成とデータ移行>パーティションの作成とデータ移行</a></li><li><a href=#%e5%8b%95%e4%bd%9c%e7%a2%ba%e8%aa%8d aria-label=動作確認>動作確認</a></li><li><a href=#%e3%83%91%e3%83%bc%e3%83%86%e3%82%a3%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ae%e5%89%8a%e9%99%a4%e3%81%a8%e6%8b%a1%e5%bc%b5 aria-label=パーティションの削除と拡張>パーティションの削除と拡張</a></li><li><a href=#%e3%83%96%e3%83%bc%e3%83%88%e8%a8%ad%e5%ae%9a%e3%81%ae%e5%89%8a%e9%99%a4 aria-label=ブート設定の削除>ブート設定の削除</a></li></ul></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考>参考</a></li></ul></div></details></div><div class=post-content><h2 id=概要>概要<a hidden class=anchor aria-hidden=true href=#概要>#</a></h2><ul><li>Ubuntu と Windows をデュアルブートしているが、Windows が不要となったため削除する。</li><li>削除した Windows のパーティションは、Ubuntu のパーティションに統合する。</li></ul><h2 id=環境>環境<a hidden class=anchor aria-hidden=true href=#環境>#</a></h2><ul><li>Ubuntu Server 24.04 LTS</li><li>Windows 11</li><li>Ubuntu Server 24.04 LTS (Live 環境)</li></ul><h2 id=調査>調査<a hidden class=anchor aria-hidden=true href=#調査>#</a></h2><p>現在のパーティションを確認する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo parted -l
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>Model: 512GB SSD (nvme)
</span></span><span style=display:flex><span>Disk /dev/nvme0n1: 512GB
</span></span><span style=display:flex><span>Sector size (logical/physical): 512B/512B
</span></span><span style=display:flex><span>Partition Table: gpt
</span></span><span style=display:flex><span>Disk Flags:
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>Number  Start   End    Size    File system  Name                          Flags
</span></span><span style=display:flex><span> 1      1049kB  106MB  105MB   fat32        EFI system partition          boot, esp
</span></span><span style=display:flex><span> 2      106MB   123MB  16.8MB               Microsoft reserved partition  msftres
</span></span><span style=display:flex><span> 3      123MB   107GB  107GB   ntfs         Basic data partition          msftdata
</span></span><span style=display:flex><span> 4      256GB   511GB  256GB   ext4         Basic data partition          msftdata
</span></span><span style=display:flex><span> 5      511GB   512GB  849MB   ntfs                                       hidden, diag
</span></span></code></pre></div><p>次の用途で使用されている。</p><ul><li><code>/dev/nvme0n1p1</code>: EFI System Partition (ESP, 共用)</li><li><code>/dev/nvme0n1p2</code>: Windows 用の Microsoft Reserved Partition (不要)</li><li><code>/dev/nvme0n1p3</code>: Windows C ドライブ (NTFS, 不要)</li><li><code>/dev/nvme0n1p4</code>: Ubuntu のルート (ext4, 必要)</li><li><code>/dev/nvme0n1p5</code>: Windows 回復パーティション (NTFS, 不要)</li></ul><p><code>p2</code>, <code>p3</code>, <code>p5</code> が Windows 関連の領域であり、削除対象となる。</p><p>削除した領域は Ubuntu で使っている <code>p4</code> を拡張したい。パーティションの移動が必要となるため、Live で起動する Ubuntu 環境を別途用意し、Live 環境でパーティションの再配置を実施する必要がある。</p><p>具体的には、<code>p2</code>, <code>p3</code>, <code>p5</code> を削除した後、新たに <code>p2</code> を作成する。その後、<code>p4</code> のデータを <code>p2</code> に移動する。最後に、<code>p4</code> を削除し、<code>p2</code> を拡張する。</p><h2 id=手順>手順<a hidden class=anchor aria-hidden=true href=#手順>#</a></h2><h3 id=live-環境の-ubuntu>Live 環境の Ubuntu<a hidden class=anchor aria-hidden=true href=#live-環境の-ubuntu>#</a></h3><p>パーティションの変更はオンライン環境では実施できないため、USB メモリ等の Live 環境で Ubuntu を起動し、作業する。Windows で USB メモリに Live 環境の Ubuntu を作成する場合は Rufus 等を使用する。</p><p>USB メモリを対象端末に接続し、USB メモリの Ubuntu を起動する。</p><p><code>Try or install Ubuntu</code> を選択する。</p><p>インストーラが起動したら、上部分にある <code>Help</code> を選択する。</p><p>SSH で作業する場合、インストーラの上部分にある <code>Help > Help on SSH access</code> を選択すると、<code>installer</code> ユーザで SSH 接続するための情報が表示される。(SSH 接続した状態でも今回の手順は実施可能であるため、作業しやすいやり方で可)</p><p><code>Help > Enter Shell</code> より、シェルを起動する。以降はこのシェル上で作業する。</p><h3 id=windows-関連パーティションの削除>Windows 関連パーティションの削除<a hidden class=anchor aria-hidden=true href=#windows-関連パーティションの削除>#</a></h3><p><strong>最悪データが消えても復旧できるように、バックアップしてから作業すること。</strong></p><p>Live 環境の Ubuntu のシェル (<code>root</code> ユーザ) にて実施する。</p><p><code>p4</code> が Ubuntu の領域 (<code>ext4</code>) であることを確認する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lsblk -f
</span></span></code></pre></div><p>Windows 関連のパーティションを削除するため、<code>parted</code> コマンドを実行する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>parted /dev/nvme0n1
</span></span></code></pre></div><p>現在のパーティションを表示する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>(parted) print
</span></span><span style=display:flex><span>Model: 512GB SSD (nvme)
</span></span><span style=display:flex><span>Disk /dev/nvme0n1: 512GB
</span></span><span style=display:flex><span>Sector size (logical/physical): 512B/512B
</span></span><span style=display:flex><span>Partition Table: gpt
</span></span><span style=display:flex><span>Disk Flags:
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>Number  Start   End    Size    File system  Name                          Flags
</span></span><span style=display:flex><span> 1      1049kB  106MB  105MB   fat32        EFI system partition          boot, esp
</span></span><span style=display:flex><span> 2      106MB   123MB  16.8MB               Microsoft reserved partition  msftres
</span></span><span style=display:flex><span> 3      123MB   107GB  107GB   ntfs         Basic data partition          msftdata
</span></span><span style=display:flex><span> 4      256GB   511GB  256GB   ext4         Basic data partition          msftdata
</span></span><span style=display:flex><span> 5      511GB   512GB  849MB   ntfs                                       hidden, diag
</span></span></code></pre></div><p><code>p2</code>, <code>p3</code>, <code>p5</code> が Windows 関連のパーティションであることを確認し、削除する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>(parted) rm 2     # Windows 用の Microsoft Reserved Partition
</span></span><span style=display:flex><span>(parted) rm 3     # Windows C ドライブ
</span></span><span style=display:flex><span>(parted) rm 5     # Windows 回復パーティション
</span></span></code></pre></div><p>削除できたことを確認する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>(parted) print
</span></span><span style=display:flex><span>Model: 512GB SSD (nvme)
</span></span><span style=display:flex><span>Disk /dev/nvme0n1: 512GB
</span></span><span style=display:flex><span>Sector size (logical/physical): 512B/512B
</span></span><span style=display:flex><span>Partition Table: gpt
</span></span><span style=display:flex><span>Disk Flags:
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>Number  Start   End    Size   File system  Name                  Flags
</span></span><span style=display:flex><span> 1      1049kB  106MB  105MB  fat32        EFI system partition  boot, esp
</span></span><span style=display:flex><span> 4      256GB   511GB  256GB  ext4         Basic data partition  msftdata
</span></span></code></pre></div><p><code>parted</code> を終了する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>(parted) quit
</span></span></code></pre></div><p><code>nvme0n1p4</code> をチェックする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>e2fsck -f /dev/nvme0n1p4
</span></span></code></pre></div><p>必要に応じて最適化する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>e2fsck 1.47.0 (5-Feb-2023)
</span></span><span style=display:flex><span>Pass 1: Checking inodes, blocks, and sizes
</span></span><span style=display:flex><span>Inode 14418651 extent tree (at level 1) could be shorter.  Optimize&lt;y&gt;? yes
</span></span><span style=display:flex><span>Pass 1E: Optimizing extent trees
</span></span><span style=display:flex><span>Pass 2: Checking directory structure
</span></span><span style=display:flex><span>Pass 3: Checking directory connectivity
</span></span><span style=display:flex><span>Pass 4: Checking reference counts
</span></span><span style=display:flex><span>Pass 5: Checking group summary information
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>/dev/nvme0n1p4: ***** FILE SYSTEM WAS MODIFIED *****
</span></span><span style=display:flex><span>/dev/nvme0n1p4: 1231810/15605760 files (0.2% non-contiguous), 24418593/62394368 blocks
</span></span></code></pre></div><h3 id=パーティションの作成とデータ移行>パーティションの作成とデータ移行<a hidden class=anchor aria-hidden=true href=#パーティションの作成とデータ移行>#</a></h3><p>Live 環境の Ubuntu のシェル (<code>root</code> ユーザ) にて実施する。</p><p>パーティションの後方に空き領域を作るため、ファイルシステムを一時的に縮小する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>resize2fs /dev/nvme0n1p4 200G
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>resize2fs 1.47.0 (5-Feb-2023)
</span></span><span style=display:flex><span>Resizing the filesystem on /dev/nvme0n1p4 to 52428800 (4k) blocks.
</span></span><span style=display:flex><span>The filesystem on /dev/nvme0n1p4 is now 52428800 (4k) blocks long.
</span></span></code></pre></div><p><code>p4</code> (<code>ext4</code>) の領域を左に移動するため、<code>parted</code> を実行する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>parted /dev/nvme0n1
</span></span></code></pre></div><p>現在の状態を再度確認する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>(parted) print
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>Model: 512GB SSD (nvme)
</span></span><span style=display:flex><span>Disk /dev/nvme0n1: 512GB
</span></span><span style=display:flex><span>Sector size (logical/physical): 512B/512B
</span></span><span style=display:flex><span>Partition Table: gpt
</span></span><span style=display:flex><span>Disk Flags:
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>Number  Start   End    Size   File system  Name                  Flags
</span></span><span style=display:flex><span> 1      1049kB  106MB  105MB  fat32        EFI system partition  boot, esp
</span></span><span style=display:flex><span> 4      256GB   511GB  256GB  ext4         Basic data partition  msftdata
</span></span></code></pre></div><p><code>p1</code> と <code>p4</code> の間 (<code>106MB</code> ~ <code>256GB</code>) に新しいパーティションを作成する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>(parted) mkpart primary ext4 106MB 256GB
</span></span></code></pre></div><p><code>p2</code> が作成されたことを確認する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>(parted) print
</span></span><span style=display:flex><span>Model: 512GB SSD (nvme)
</span></span><span style=display:flex><span>Disk /dev/nvme0n1: 512GB
</span></span><span style=display:flex><span>Sector size (logical/physical): 512B/512B
</span></span><span style=display:flex><span>Partition Table: gpt
</span></span><span style=display:flex><span>Disk Flags:
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>Number  Start   End    Size   File system  Name                  Flags
</span></span><span style=display:flex><span> 1      1049kB  106MB  105MB  fat32        EFI system partition  boot, esp
</span></span><span style=display:flex><span> 2      106MB   256GB  256GB  ext4         primary
</span></span><span style=display:flex><span> 4      256GB   511GB  256GB  ext4         Basic data partition  msftdata
</span></span></code></pre></div><p><code>parted</code> を終了する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>(parted) quit
</span></span></code></pre></div><p>作成した <code>p2</code> をフォーマットする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkfs.ext4 /dev/nvme0n1p2
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>mke2fs 1.47.0 (5-Feb-2023)
</span></span><span style=display:flex><span>Discarding device blocks: done
</span></span><span style=display:flex><span>Creating filesystem with 62398720 4k blocks and 15605760 inodes
</span></span><span style=display:flex><span>Filesystem UUID: 2543fd22-fc5d-430f-87be-9ef247334f4e
</span></span><span style=display:flex><span>Superblock backups stored on blocks:
</span></span><span style=display:flex><span>        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
</span></span><span style=display:flex><span>        4096000, 7962624, 11239424, 20480000, 23887872
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>Allocating group tables: done
</span></span><span style=display:flex><span>Writing inode tables: done
</span></span><span style=display:flex><span>Creating journal (262144 blocks): done
</span></span><span style=display:flex><span>Writing superblocks and filesystem accounting information: done
</span></span></code></pre></div><p><code>p4</code> と <code>p2</code> をそれぞれマウントする。(今回は移行元を <code>/mnt/old</code> とし、移行先を <code>/mnt/new</code> とする。)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir /mnt/old <span style=color:#f92672>&amp;&amp;</span> mount /dev/nvme0n1p4 /mnt/old
</span></span><span style=display:flex><span>mkdir /mnt/new <span style=color:#f92672>&amp;&amp;</span> mount /dev/nvme0n1p2 /mnt/new
</span></span></code></pre></div><p>データの使用量を確認する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>df -h
</span></span></code></pre></div><p><code>p4</code> の使用量が <code>p2</code> より小さいことを確認する。もし <code>p2</code> より大きい場合は、別の領域に <code>p4</code> のデータをバックアップする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>...
</span></span><span style=display:flex><span>/dev/nvme0n1p2  234G   28K  222G   1% /mnt/new
</span></span><span style=display:flex><span>/dev/nvme0n1p4  196G   89G   98G  48% /mnt/old
</span></span></code></pre></div><p><code>p4</code> にあるデータを <code>p2</code> にコピーする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rsync -aHAX /mnt/old/ /mnt/new/
</span></span></code></pre></div><p>アンマウントする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>umount /mnt/new
</span></span><span style=display:flex><span>umount /mnt/old
</span></span></code></pre></div><p><code>p2</code> をチェックする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>e2fsck -f /dev/nvme0n1p2
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>e2fsck 1.47.0 (5-Feb-2023)
</span></span><span style=display:flex><span>Pass 1: Checking inodes, blocks, and sizes
</span></span><span style=display:flex><span>Pass 2: Checking directory structure
</span></span><span style=display:flex><span>Pass 3: Checking directory connectivity
</span></span><span style=display:flex><span>Pass 4: Checking reference counts
</span></span><span style=display:flex><span>Pass 5: Checking group summary information
</span></span><span style=display:flex><span>/dev/nvme0n1p2: 1231810/15605760 files (0.1% non-contiguous), 24516082/62398720 blocks
</span></span></code></pre></div><h3 id=動作確認>動作確認<a hidden class=anchor aria-hidden=true href=#動作確認>#</a></h3><p>Live 環境の Ubuntu のシェル (<code>root</code> ユーザ) にて実施する。</p><p><code>p4</code> を削除する前に、<code>p2</code> のデータで正しく起動できるか確認する。</p><p><code>p2</code> の UUID を確認する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>blkid /dev/nvme0n1p2
</span></span></code></pre></div><p>UUID の値をコピーしておく。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>/dev/nvme0n1p2: UUID=&#34;2543fd22-fc5d-430f-87be-9ef247334f4e&#34; BLOCK_SIZE=&#34;4096&#34; TYPE=&#34;ext4&#34; PARTLABEL=&#34;primary&#34; PARTUUID=&#34;78887ccc-a4be-45ea-a88d-f8e0bdc90f64&#34;
</span></span></code></pre></div><p>同様にして、<code>p4</code> の UUID も確認する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>blkid /dev/nvme0n1p4
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>/dev/nvme0n1p4: UUID=&#34;e5bc1fee-fc92-4b0f-8b8c-7bc78cf72f86&#34; BLOCK_SIZE=&#34;4096&#34; TYPE=&#34;ext4&#34; PARTLABEL=&#34;Basic data partition&#34; PARTUUID=&#34;075a8eda-ecb5-428b-994a-f59333013d01&#34;
</span></span></code></pre></div><p>ブートローダを更新するため、必要な仮想ファイルシステムをバインドする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mount /dev/nvme0n1p2 /mnt/new
</span></span><span style=display:flex><span>mount /dev/nvme0n1p1 /mnt/new/boot/efi
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i in /dev /dev/pts /proc /sys /run; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    mount --bind $i /mnt/new$i
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p><code>chroot</code> 環境に入る。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chroot /mnt/new
</span></span></code></pre></div><p><code>grub.cfg</code> の中身を確認する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>less /boot/efi/EFI/ubuntu/grub.cfg
</span></span></code></pre></div><p><code>p4</code> の UUID が root に設定されている。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>search.fs_uuid e5bc1fee-fc92-4b0f-8b8c-7bc78cf72f86 root
</span></span><span style=display:flex><span>set prefix=($root)&#39;/boot/grub&#39;
</span></span><span style=display:flex><span>configfile $prefix/grub.cfg
</span></span></code></pre></div><p>任意のエディタで <code>/etc/fstab</code> を開く。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vi /etc/fstab
</span></span></code></pre></div><p>既存の <code>p4</code> のエントリの UUID を書き換え、上書き保存する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>- /dev/disk/by-uuid/e5bc1fee-fc92-4b0f-8b8c-7bc78cf72f86 / ext4 defaults 0 1
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>+ /dev/disk/by-uuid/2543fd22-fc5d-430f-87be-9ef247334f4e / ext4 defaults 0 1
</span></span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>GRUB を再生成する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>grub-install --target<span style=color:#f92672>=</span>x86_64-efi --efi-directory<span style=color:#f92672>=</span>/boot/efi --bootloader-id<span style=color:#f92672>=</span>ubuntu
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>Installing for x86_64-efi platform.
</span></span><span style=display:flex><span>grub-install: warning: EFI variables cannot be set on this system.
</span></span><span style=display:flex><span>grub-install: warning: You will have to complete the GRUB setup manually.
</span></span><span style=display:flex><span>Installation finished. No error reported.
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>update-grub
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>Sourcing file `/etc/default/grub&#39;
</span></span><span style=display:flex><span>Generating grub configuration file ...
</span></span><span style=display:flex><span>Found linux image: /boot/vmlinuz-6.8.0-79-generic
</span></span><span style=display:flex><span>Found initrd image: /boot/initrd.img-6.8.0-79-generic
</span></span><span style=display:flex><span>Found linux image: /boot/vmlinuz-6.8.0-78-generic
</span></span><span style=display:flex><span>Found initrd image: /boot/initrd.img-6.8.0-78-generic
</span></span><span style=display:flex><span>Warning: os-prober will be executed to detect other bootable partitions.
</span></span><span style=display:flex><span>Its output will be used to detect bootable binaries on them and create new boot entries.
</span></span><span style=display:flex><span>Found Windows Boot Manager on /dev/nvme0n1p1@/EFI/Microsoft/Boot/bootmgfw.efi
</span></span><span style=display:flex><span>Found Ubuntu 24.04.3 LTS (24.04) on /dev/nvme0n1p4
</span></span><span style=display:flex><span>Adding boot menu entry for UEFI Firmware Settings ...
</span></span><span style=display:flex><span>done
</span></span></code></pre></div><p><code>grub.cfg</code> の中身を確認する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>less /boot/efi/EFI/ubuntu/grub.cfg
</span></span></code></pre></div><p><code>p2</code> の UUID が root に設定されている。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>search.fs_uuid 2543fd22-fc5d-430f-87be-9ef247334f4e root
</span></span><span style=display:flex><span>set prefix=($root)&#39;/boot/grub&#39;
</span></span><span style=display:flex><span>configfile $prefix/grub.cfg
</span></span></code></pre></div><p>この時点で、 <code>p2</code> をもとに起動するはずなので、サーバを再起動する。(ブートローダの選択肢で <code>p4</code> の Ubuntu を選ばないように注意する。)</p><p><code>p2</code> で Ubuntu が起動したら、SSH 接続や各種サービスの利用等、問題なく使えることを確認する。</p><h3 id=パーティションの削除と拡張>パーティションの削除と拡張<a hidden class=anchor aria-hidden=true href=#パーティションの削除と拡張>#</a></h3><p><code>p2</code> で問題なく起動できることが確認出来たら、 <code>p4</code> を削除し、 <code>p2</code> を拡張する。</p><p>以降の手順は Live 環境の Ubuntu で実行する。</p><p><code>parted</code> コマンドを実行する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>parted /dev/nvme0n1
</span></span></code></pre></div><p>現在のパーティションを表示する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>(parted) print
</span></span><span style=display:flex><span>Model: 512GB SSD (nvme)
</span></span><span style=display:flex><span>Disk /dev/nvme0n1: 512GB
</span></span><span style=display:flex><span>Sector size (logical/physical): 512B/512B
</span></span><span style=display:flex><span>Partition Table: gpt
</span></span><span style=display:flex><span>Disk Flags:
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>Number  Start   End    Size   File system  Name                  Flags
</span></span><span style=display:flex><span> 1      1049kB  106MB  105MB  fat32        EFI system partition  boot, esp
</span></span><span style=display:flex><span> 2      106MB   256GB  256GB  ext4         primary
</span></span><span style=display:flex><span> 4      256GB   511GB  256GB  ext4         Basic data partition  msftdata
</span></span></code></pre></div><p><code>p4</code> を削除し、<code>p2</code> のサイズを <code>100%</code> にする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>(parted) rm 4
</span></span><span style=display:flex><span>(parted) resizepart 2 100%
</span></span></code></pre></div><p>現在のパーティションを表示し、<code>p2</code> が最大サイズまで拡張されていることを確認する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>(parted) print
</span></span><span style=display:flex><span>Model: 512GB SSD (nvme)
</span></span><span style=display:flex><span>Disk /dev/nvme0n1: 512GB
</span></span><span style=display:flex><span>Sector size (logical/physical): 512B/512B
</span></span><span style=display:flex><span>Partition Table: gpt
</span></span><span style=display:flex><span>Disk Flags:
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span>Number  Start   End    Size   File system  Name                  Flags
</span></span><span style=display:flex><span> 1      1049kB  106MB  105MB  fat32        EFI system partition  boot, esp
</span></span><span style=display:flex><span> 2      106MB   512GB  512GB  ext4         primary
</span></span></code></pre></div><p><code>parted</code> を終了する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>(parted) quit
</span></span></code></pre></div><p><code>p2</code> をチェックする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>e2fsck -f /dev/nvme0n1p2
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>e2fsck 1.47.0 (5-Feb-2023)
</span></span><span style=display:flex><span>Pass 1: Checking inodes, blocks, and sizes
</span></span><span style=display:flex><span>Pass 2: Checking directory structure
</span></span><span style=display:flex><span>Pass 3: Checking directory connectivity
</span></span><span style=display:flex><span>Pass 4: Checking reference counts
</span></span><span style=display:flex><span>Pass 5: Checking group summary information
</span></span><span style=display:flex><span>/dev/nvme0n1p2: 1231812/15605760 files (0.1% non-contiguous), 24481005/62398720 blocks
</span></span></code></pre></div><p><code>p2</code> のファイルシステムを最大まで拡張する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>resize2fs /dev/nvme0n1p2
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>resize2fs 1.47.0 (5-Feb-2023)
</span></span><span style=display:flex><span>Resizing the filesystem on /dev/nvme0n1p2 to 125001041 (4k) blocks.
</span></span><span style=display:flex><span>The filesystem on /dev/nvme0n1p2 is now 125001041 (4k) blocks long.
</span></span></code></pre></div><p>再起動し、問題なく起動することを確認する。</p><h3 id=ブート設定の削除>ブート設定の削除<a hidden class=anchor aria-hidden=true href=#ブート設定の削除>#</a></h3><p>EFI にある Windows のブート設定を削除する。この作業は Live の Ubuntu ではなく、<code>p2</code> にある Ubuntu を起動し、ログインした状態で実施する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mount /dev/nvme0n1p1 /mnt
</span></span><span style=display:flex><span>sudo rm -rf /mnt/EFI/Microsoft
</span></span><span style=display:flex><span>sudo umount /mnt
</span></span></code></pre></div><p>GRUB を再生成する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo update-grub
</span></span></code></pre></div><p>これでブートローダの選択肢から不要な OS が消え、パーティション <code>p2</code> の Ubuntu が起動する。</p><h2 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h2><ul><li><a href=https://man.archlinux.org/man/parted.8>parted(8) — Arch manual pages</a></li><li><a href=https://man.archlinux.org/man/e2fsck.8>e2fsck(8) — Arch manual pages</a></li><li><a href=https://man.archlinux.org/man/resize2fs.8>resize2fs(8) — Arch manual pages</a></li><li><a href=https://man.archlinux.org/man/grub-install.8>grub-install(8) — Arch manual pages</a></li><li><a href=https://man.archlinux.org/man/efibootmgr.8.en>efibootmgr(8) — Arch manual pages</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://h10i.github.io/posts/2025/09/11/disable-windows-path-inheritance-in-wsl/><span class=title>« 前へ</span><br><span>WSL で Windows の PATH を引き継がないようにする</span>
</a><a class=next href=https://h10i.github.io/posts/2025/08/29/troubleshooting-too-many-connections-in-nextcloud/><span class=title>次へ »</span><br><span>Nextcloud で Too many connections エラーが出たときの対処</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://h10i.github.io/>h10i</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="コピー";function s(){t.innerHTML="コピーされました!",setTimeout(()=>{t.innerHTML="コピー"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>